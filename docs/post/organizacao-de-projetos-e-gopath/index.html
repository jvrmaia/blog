<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Organização de projetos e GOPATH - João Maia</title>
</head>
<body>
  <a href="http://localhost:1313/">← Voltar</a>
  <article>
    <h1>Organização de projetos e GOPATH</h1>
    <div><p>Olá,</p>
<p>Esse é um tópico que acaba sendo polêmico onde cada um acaba tendo uma opinião sobre e fazendo uma busca rápida no Google você pode confirmar isso. Como sempre, tem uma recomendação oficial da linguagem e diversas outras alternativas que emergem da comunidade ou formas que empresas acharam para lidar com a sua complexidade de controlar o projeto. Nesse artigo vamos navegar por essas abordagens e ver o que elas trazem de interessante ou não.</p>
<h1 id="recomendação-oficial">Recomendação oficial</h1>
<p>Em <a href="https://golang.org/doc/code.html">&ldquo;How to Write Go Code&rdquo;</a> você vai econtrar um guia de como começar o seu projeto já usando Go Modules criando um projeto bem simples com importação de package e testes. Vamos fazer ele aqui juntos de forma mais breve?</p>
<p>Primeiro vou trocar meu diretório atual para <code>$HOME/Workspace/temp</code> que é um lugar que uso para testar coisas novas e pequenas demonstrações que sei que vou poder apagar depois qualquer coisa dentro sem grandes perdas. A seguir, vou criar a pasta do projeto como é dito no tutorial:</p>
<pre><code>$ mkdir hello &amp;&amp; cd $_
</code></pre>
<p>Agora, já dentro da pasta do projeto que estou criando vou inicializar o projeto:</p>
<pre><code>$ go mod init github.com/jvrmaia/hello
go: creating new go.mod: module github.com/jvrmaia/hello
$ cat go.mod
module github.com/jvrmaia/hello

go 1.13
</code></pre>
<p>Nosso primeiro código vai ser esse, <code>hello.go</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello, world.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Feito isso, podes agora testar rodar nosso código, podemos fazer de 3 formas:</p>
<h2 id="go-run">go run</h2>
<pre><code>$ go run hello.go
</code></pre>
<h2 id="go-build">go build</h2>
<pre><code>$ go build hello.go
$ ./hello
</code></pre>
<h2 id="go-install">go install</h2>
<pre><code>$ go install
$ hello
</code></pre>
<p>Repare que na terceira opção eu não precisei passar o caminho do binário pois foi inserido no meu <code>$PATH</code>. Como isso acontece? No caso, estou usando o Go instalado pelo <a href="https://brew.sh/">Brew</a> e meu <code>$GOROOT</code> e <code>$GOPATH</code> configurados pelo <code>gvm</code> da seguinte forma:</p>
<pre><code>GOPATH=/home/jvrmaia/.gvm/pkgsets/system/global
GOROOT=/home/linuxbrew/.linuxbrew/Cellar/go/1.13.6/libexec
</code></pre>
<p>Porém, isso não basta para ter funcionado, o <code>gvm</code> também cuida para mim de colocar o <code>$GOPATH</code> no meu <code>$PATH</code> o que garante esse funcionamento.</p>
<p>Agora que já executamos uma primeira versão desse nosso projeto vamos adicionar uma biblioteca nova a ele chamada <code>morestrings</code>:</p>
<pre><code>$ mkdir morestrings
$ cat &gt;morestrings.go&lt;&lt;EOF
// Package morestrings implements additional functions to manipulate UTF-8
// encoded strings, beyond what is provided in the standard &quot;strings&quot; package.
package morestrings

// ReverseRunes returns its argument string reversed rune-wise left to right.
func ReverseRunes(s string) string {
    r := []rune(s)
    for i, j := 0, len(r)-1; i &lt; len(r)/2; i, j = i+1, j-1 {
        r[i], r[j] = r[j], r[i]
    }
    return string(r)
}
EOF
</code></pre>
<p>Feito isso, vamos adicionar ela no nosso projeto inicial do <code>hello</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;github.com/user/hello/morestrings&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">morestrings</span><span class="p">.</span><span class="nf">ReverseRunes</span><span class="p">(</span><span class="s">&#34;!oG ,olleH&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Executando como visto antes vamos ter a reposta: <code>Hello, Go!</code>. Agora, vamos adicionar uma biblioteca externa no nosso projeto:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;github.com/jvrmaia/hello/morestrings&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;github.com/google/go-cmp/cmp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">morestrings</span><span class="p">.</span><span class="nf">ReverseRunes</span><span class="p">(</span><span class="s">&#34;!oG ,olleH&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">cmp</span><span class="p">.</span><span class="nf">Diff</span><span class="p">(</span><span class="s">&#34;Hello World&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Hello Go&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Executando vamos ter o seguinte resultado:</p>
<pre tabindex="0"><code>$ go run hello.go
go: downloading github.com/google/go-cmp v0.4.0
go: extracting github.com/google/go-cmp v0.4.0
go: finding github.com/google/go-cmp v0.4.0
Hello, Go!
  string(
- 	&#34;Hello World&#34;,
+ 	&#34;Hello Go&#34;,
  )
</code></pre><p>E consequentemente algumas mudanças no seu <code>go.mod</code> e <code>go.sum</code> utilizado pelo Go Modules:</p>
<pre><code>$ cat go.mod
module github.com/jvrmaia/hello

go 1.13

require github.com/google/go-cmp v0.4.0 // indirect
$ cat go.sum
github.com/google/go-cmp v0.4.0 h1:xsAVV57WRhGj6kEIi8ReJzQlHHqcBYCElAvkovg3B/4=
github.com/google/go-cmp v0.4.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
</code></pre>
<p>Por fim e não menos importante, vamos colocar testes no projeto:</p>
<pre><code>cat &gt;morestrings/reverse_test.go&lt;&lt;EOF
package morestrings

import &quot;testing&quot;

func TestReverseRunes(t *testing.T) {
    cases := []struct {
        in, want string
    }{
        {&quot;Hello, world&quot;, &quot;dlrow ,olleH&quot;},
        {&quot;Hello, 世界&quot;, &quot;界世 ,olleH&quot;},
        {&quot;&quot;, &quot;&quot;},
    }
    for _, c := range cases {
        got := ReverseRunes(c.in)
        if got != c.want {
            t.Errorf(&quot;ReverseRunes(%q) == %q, want %q&quot;, c.in, got, c.want)
        }
    }
}
EOF
</code></pre>
<p>Para executar os testes é bem simples:</p>
<pre><code>$ go test -v ./morestrings/
=== RUN   TestReverseRunes
--- PASS: TestReverseRunes (0.00s)
PASS
ok  	github.com/jvrmaia/hello/morestrings	0.002s
</code></pre>
<p>Bem legal, não?</p>
<h1 id="uma-proposta-de-organização-de-projeto">Uma proposta de organização de projeto</h1>
<blockquote>
<p>This is an opinionated Go project template you can use as a starting point for your project. It doesn&rsquo;t include any code generation, so you&rsquo;ll need to replace the placeholder variables/values/names with your own.</p>
<p>Clone the repository, keep what you need and delete everything else! Feel free to replace the parts that don&rsquo;t align with your use cases (e.g., you may prefer/use a different vendoring tool).</p>
<p>See <a href="https://github.com/golang-standards/project-layout">Go Project Layout</a> for a more generic and a less opinionated starting point for your project.</p>
</blockquote>
<p>Essa é uma proposta de organização que me agrada bastante pois tem uma Makefile para ajudar a estruturar tarefas básicas como compilar, testar e preparar o empacotamento do projeto. As pastas são escolhidas de formas claras a entender onde estão os códigos e suas finalidades. No tópico seguinte vamos ver estrutura semelhante a essa em projetos de código aberto.</p>
<h1 id="olhando-projetos-de-código-aberto">Olhando projetos de código aberto</h1>
<p>Vou demonstrar dois projetos abertos, um nacional e outro internacional que já estão com Go Modules. No meu github tem um código antigo que usa <a href="https://github.com/jvrmaia/golang-testing-examples">go dep</a>. Nos exemplos abaixo vamos ver uma s</p>
<h2 id="tsuru">Tsuru</h2>
<p>O repositório deles ficam <a href="https://github.com/tsuru/tsuru">aqui</a>. Como podem ver, já usam Go Modules e na raíz do projeto já começa o código com os packages separados por pastas com a pasta <code>vendor</code>.</p>
<h2 id="kubernetes">Kubernetes</h2>
<p>O repositório deles ficam <a href="https://github.com/kubernetes/kubernetes">aqui</a>. Como podem ver, já usam Go Modules e na raíz do projeto já começa o código com os packages separados por pastas com a pasta <code>vendor</code>.</p>
<h1 id="o-caso-da-digital-ocean">O caso da Digital Ocean</h1>
<blockquote>
<p><a href="https://blog.digitalocean.com/cthulhu-organizing-go-code-in-a-scalable-repo/">Cthulhu: Organizing Go Code in a Scalable Repo</a></p>
</blockquote>
<p>Como eles menos já definem no começo &ldquo;mono repo&rdquo;! Como vinha mostrando aqui no artigo a ideia é que cada projeto seu tenha o seu repositório. Nesse caso da Digital Ocean a estratégia foi juntar todos os projetos no mesmo repositório e compartilhar as dependências. Vale a pena ler e entender se os problemas e soluções fazem sentido ao seu contexto. Diga o que achou nos comentários!</p>
<h1 id="um-pouco-mais-sobre-o-gopath">Um pouco mais sobre o $GOPATH</h1>
<p>Na primeira parte do artigo no projeto <code>hello</code> fizemos um package e nessa mesma instalação e configuração de Go acabei testando algumas outras coisas, só lembrando o meu <code>$GOPATH</code>:</p>
<pre><code>GOPATH=/home/jvrmaia/.gvm/pkgsets/system/global
</code></pre>
<p>Agora, vamos inspecionar o que tem nele:</p>
<pre><code>$ ls /home/jvrmaia/.gvm/pkgsets/system/global
bin/  pkg/  src/
</code></pre>
<p>Inspecionando mais afundo:</p>
<pre><code>$ tree -L 3 /home/jvrmaia/.gvm/pkgsets/system/global
/home/jvrmaia/.gvm/pkgsets/system/global
├── bin
│   └── hello
├── pkg
│   └── mod
│       ├── cache
│       ├── github.com
│       ├── gopkg.in
│       └── go.uber.org
└── src
    └── github.com
        ├── go-chi
        ├── golang
        ├── gorilla
        ├── go-sql-driver
        ├── miguelpragier
        └── tinrab

15 directories, 1 file
</code></pre>
<p>Veja que tem várias outras não relacionadas ao <code>hello</code> e isso pode ser um problema no seu projeto se ficar compartilhando dependências entre projetos pois se estiverem em versões diferentes pode causar sérios problemas no seu projeto. Então, como resolver isso?</p>
<p>Como uso o gvm, eu gosto de usar um recurso que já vem nele de isolamento de projetos:</p>
<pre><code>$ gvm pkgset
= gvm pkgset

* http://github.com/moovweb/gvm

== DESCRIPTION:

GVM pkgset is used to manage various Go packages

== Usage

gvm pkgset Command

== Command

create     - create a new package set
delete     - delete a package set
use        - select where gb and goinstall target and link
empty      - remove all code and compiled binaries from package set
list       - list installed go packages
</code></pre>
<p>Como usar:</p>
<pre><code>$ gvm pkgset create hello
$ gvm pkgset use hello
Now using version system@hello
$ env | grep GO
GOPATH=/home/jvrmaia/.gvm/pkgsets/system/hello:/home/jvrmaia/.gvm/pkgsets/system/global
GOROOT=/home/linuxbrew/.linuxbrew/Cellar/go/1.13.6/libexec
</code></pre>
<p>Agoram vamos repetir o passo de instalação do projeto igual vimos na primeira parte:</p>
<pre><code>$ go install
go: downloading github.com/google/go-cmp v0.4.0
go: extracting github.com/google/go-cmp v0.4.0
go: finding github.com/google/go-cmp v0.4.0
</code></pre>
<p>Repare que ele instalou novamente a biblioteca <code>go-cmp</code>, por quê?</p>
<pre><code>$ ls /home/jvrmaia/.gvm/pkgsets/system/hello/pkg/mod/github.com/google/
'go-cmp@v0.4.0'/
</code></pre>
<p>Porque agora ele foi instalada no ambiente que você criou com o <code>gvm</code>. Legal, não?</p>
<p>Nova localização do binário do <code>hello</code>:</p>
<pre><code>$ whereis hello
hello: /home/jvrmaia/.gvm/pkgsets/system/hello/bin/hello /home/jvrmaia/.gvm/pkgsets/system/global/bin/hello
</code></pre>
<p>Mais informações sobre como funciona o <code>$PATH</code> podem ser lidas <a href="https://medium.com/@jalendport/what-exactly-is-your-shell-path-2f076f02deb4">aqui</a>.</p>
<h1 id="outros-artigos-relacionados-que-valem-a-pena-ler">Outros artigos relacionados que valem a pena ler</h1>
<ul>
<li><a href="https://vsupalov.com/go-folder-structure/">How to structure a Go project?</a></li>
<li><a href="https://manfred.life/golang-project-layout">Golang project layout</a></li>
<li><a href="https://tutorialedge.net/golang/go-project-structure-best-practices/">Go Project Structure Best Practices</a></li>
<li><a href="https://eli.thegreenplace.net/2019/simple-go-project-layout-with-modules/">Simple Go project layout with modules</a></li>
<li><a href="https://github.com/katzien/go-structure-examples">Examples for my talk on structuring go apps</a></li>
<li><a href="https://www.youtube.com/watch?v=B5oQnECDJ8g&amp;feature=emb_logo">LondonGophers 19/09/2018: Kat Zien - How Do You Structure Your Go Apps?</a></li>
</ul>
<h1 id="atualizações">Atualizações</h1>
<ul>
<li>17/01/2019: Contribuições do Joelson do Telegram Go Brasil</li>
</ul>
</div>
  </article>
  <footer>
    <p>© 2026 João Maia</p>
  </footer>
</body>
</html>
