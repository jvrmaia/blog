<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Desenhando infraestrutura com código - João Maia</title>
</head>
<body>
  <a href="http://localhost:1313/">← Voltar</a>
  <article>
    <h1>Desenhando infraestrutura com código</h1>
    <div><p>Olá,</p>
<p>Documentar é um processo importante no processo de criação da sua infraestrutura pois ajuda a todos da empresa terem visibilidade da arquitetura atual e pensar em possibilidades de melhorias e ajudar nos momentos de incidentes. Criar documentação é um processo chato para a maioria das pessoas da área de tecnologia e nem todos gostam de ferramentas visuais que muito fácil pode virar uma confusão total. Várias soluções para diagramas existem por ai sendo algumas delas o <a href="https://www.lucidchart.com/">Lucidchart</a>, <a href="https://cloudcraft.co/">Cloudcraft</a> e <a href="https://app.diagrams.net/">draw.io</a>.</p>
<p>Como desenvolvedores gostam de programar, por que não desenhar a infraestrutura programando? Pensando nessa possibilidade procurei ferramentas para isso e acabei encontrando o <a href="https://diagrams.mingrammer.com/">Diagrams</a>, um projeto feito em Python que possibilita desenhar sua infraestrutura para as principais clouds do mercado (<a href="https://diagrams.mingrammer.com/docs/nodes/aws">AWS</a>, <a href="https://diagrams.mingrammer.com/docs/nodes/gcp">GCP</a>, <a href="https://diagrams.mingrammer.com/docs/nodes/azure">Azure</a> e <a href="https://diagrams.mingrammer.com/docs/nodes/alibabacloud">AlibabaCloud</a>) e outras coisas mais (<a href="https://diagrams.mingrammer.com/docs/nodes/k8s">k8s</a> e <a href="https://diagrams.mingrammer.com/docs/nodes/onprem">OnPremise</a>).</p>
<p><img src="/img/desenhando-infraestrutura-com-codigo/diagrams.png" alt="Diagrams"></p>
<h1 id="objetos">Objetos</h1>
<p>O <code>Diagrams</code> possui quatro objetos principais para desenhar diagramas: <code>Diagram</code>, <code>Node</code>, <code>Cluster</code> e <code>Edge</code>.</p>
<h2 id="diagram">Diagram</h2>
<p>Esse é o seu desenho final que vai ser exportado em imagem. Ele pode ser modificado para exportar o diagrama nos seguintes formatos: png, jpg, svg, e pdf.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Diagram</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&#34;Minha infra&#34;</span><span class="p">,</span> <span class="n">outformat</span><span class="o">=</span><span class="s2">&#34;jpg&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></div><h2 id="node">Node</h2>
<p>São os componentes do seu diagrama, por exemplo, EC2, RDS, Docker e outros.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Diagram</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">EC2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.database</span> <span class="kn">import</span> <span class="n">RDS</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">ELB</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.storage</span> <span class="kn">import</span> <span class="n">S3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&#34;Web Services&#34;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ELB</span><span class="p">(</span><span class="s2">&#34;lb&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">EC2</span><span class="p">(</span><span class="s2">&#34;web&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;userdb&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">S3</span><span class="p">(</span><span class="s2">&#34;store&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ELB</span><span class="p">(</span><span class="s2">&#34;lb&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">EC2</span><span class="p">(</span><span class="s2">&#34;web&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;userdb&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">EC2</span><span class="p">(</span><span class="s2">&#34;stat&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">ELB</span><span class="p">(</span><span class="s2">&#34;lb&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">EC2</span><span class="p">(</span><span class="s2">&#34;web&#34;</span><span class="p">))</span> <span class="o">-</span> <span class="n">EC2</span><span class="p">(</span><span class="s2">&#34;web&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;userdb&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Os objetos do tipo <code>Node</code> possuem operadores especiais: <code>&gt;&gt;</code>, <code>&lt;&lt;</code> e <code>-</code>. Eles são usados para mostrar a direção da conexão dos componentes, no caso do <code>-</code> a direção é nos 2 sentidos.</p>
<h2 id="cluster">Cluster</h2>
<p>É a forma que agrupamos os componentes da nossa infraestrutura.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">Diagram</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">ECS</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.database</span> <span class="kn">import</span> <span class="n">RDS</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">Route53</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&#34;Simple Web Service with DB Cluster&#34;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dns</span> <span class="o">=</span> <span class="n">Route53</span><span class="p">(</span><span class="s2">&#34;dns&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">web</span> <span class="o">=</span> <span class="n">ECS</span><span class="p">(</span><span class="s2">&#34;service&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;DB Cluster&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">db_master</span> <span class="o">=</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;master&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">db_master</span> <span class="o">-</span> <span class="p">[</span><span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;slave1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                     <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;slave2&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">dns</span> <span class="o">&gt;&gt;</span> <span class="n">web</span> <span class="o">&gt;&gt;</span> <span class="n">db_master</span>
</span></span></code></pre></div><h2 id="edge">Edge</h2>
<p>São as operações especiais de conexões entre os componentes que vimos em <code>Node</code>. Aqui tornamos ela explícita para customizações.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">Diagram</span><span class="p">,</span> <span class="n">Edge</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.analytics</span> <span class="kn">import</span> <span class="n">Spark</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.compute</span> <span class="kn">import</span> <span class="n">Server</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.database</span> <span class="kn">import</span> <span class="n">PostgreSQL</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.inmemory</span> <span class="kn">import</span> <span class="n">Redis</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.logging</span> <span class="kn">import</span> <span class="n">Fluentd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.monitoring</span> <span class="kn">import</span> <span class="n">Grafana</span><span class="p">,</span> <span class="n">Prometheus</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.network</span> <span class="kn">import</span> <span class="n">Nginx</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.queue</span> <span class="kn">import</span> <span class="n">Kafka</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;Advanced Web Service with On-Premise (colored)&#34;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ingress</span> <span class="o">=</span> <span class="n">Nginx</span><span class="p">(</span><span class="s2">&#34;ingress&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="n">Prometheus</span><span class="p">(</span><span class="s2">&#34;metric&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">&lt;&lt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;firebrick&#34;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;dashed&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Grafana</span><span class="p">(</span><span class="s2">&#34;monitoring&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;Service Cluster&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">grpcsvc</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">Server</span><span class="p">(</span><span class="s2">&#34;grpc1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">Server</span><span class="p">(</span><span class="s2">&#34;grpc2&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">Server</span><span class="p">(</span><span class="s2">&#34;grpc3&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;Sessions HA&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">master</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="s2">&#34;session&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">master</span> <span class="o">-</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;brown&#34;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;dashed&#34;</span><span class="p">)</span> <span class="o">-</span> <span class="n">Redis</span><span class="p">(</span><span class="s2">&#34;replica&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&#34;collect&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">metrics</span>
</span></span><span class="line"><span class="cl">        <span class="n">grpcsvc</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;brown&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">master</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;Database HA&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">master</span> <span class="o">=</span> <span class="n">PostgreSQL</span><span class="p">(</span><span class="s2">&#34;users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">master</span> <span class="o">-</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;brown&#34;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;dotted&#34;</span><span class="p">)</span> <span class="o">-</span> <span class="n">PostgreSQL</span><span class="p">(</span><span class="s2">&#34;slave&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&#34;collect&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">metrics</span>
</span></span><span class="line"><span class="cl">        <span class="n">grpcsvc</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;black&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">master</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">aggregator</span> <span class="o">=</span> <span class="n">Fluentd</span><span class="p">(</span><span class="s2">&#34;logging&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&#34;parse&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Kafka</span><span class="p">(</span><span class="s2">&#34;stream&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;black&#34;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&#34;bold&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Spark</span><span class="p">(</span><span class="s2">&#34;analytics&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ingress</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;darkgreen&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">grpcsvc</span> <span class="o">&gt;&gt;</span> <span class="n">Edge</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&#34;darkorange&#34;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">aggregator</span>
</span></span></code></pre></div><h1 id="exemplos">Exemplos</h1>
<p>O fonte dos exemplos estão <a href="https://github.com/jvrmaia/diagram-as-code">aqui</a>.</p>
<h2 id="blog">Blog</h2>
<h3 id="código">Código</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">Diagram</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">VPC</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.database</span> <span class="kn">import</span> <span class="n">RDS</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">Route53</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.network</span> <span class="kn">import</span> <span class="n">Nginx</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.container</span> <span class="kn">import</span> <span class="n">Docker</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&#34;Blog stack&#34;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;AWS&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">dns</span> <span class="o">=</span> <span class="n">Route53</span><span class="p">(</span><span class="s2">&#34;meu.blog.br&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;us-east-1&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">blog_vpc</span> <span class="o">=</span> <span class="n">VPC</span><span class="p">(</span><span class="s2">&#34;blog_vpc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">dns</span> <span class="o">&gt;&gt;</span> <span class="n">blog_vpc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;blog_vpc&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">nginx</span> <span class="o">=</span> <span class="n">Nginx</span><span class="p">(</span><span class="s2">&#34;proxy&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">docker</span> <span class="o">=</span> <span class="n">Docker</span><span class="p">(</span><span class="s2">&#34;blog&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">postgres</span> <span class="o">=</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&#34;postgres&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">blog_vpc</span> <span class="o">&gt;&gt;</span> <span class="n">nginx</span> <span class="o">&gt;&gt;</span> <span class="n">docker</span> <span class="o">&gt;&gt;</span> <span class="n">postgres</span>
</span></span></code></pre></div><h3 id="desenho">Desenho</h3>
<p><img src="/img/desenhando-infraestrutura-com-codigo/blog_stack.png" alt="blog stack"></p>
<h2 id="elastic-stack">Elastic Stack</h2>
<h3 id="código-1">Código</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">Diagram</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.database</span> <span class="kn">import</span> <span class="n">Cassandra</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.monitoring</span> <span class="kn">import</span> <span class="n">Kibana</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.search</span> <span class="kn">import</span> <span class="n">Elasticsearch</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">diagrams.onprem.logging</span> <span class="kn">import</span> <span class="n">Logstash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&#34;ELK&#34;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">&#34;cassandra&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">cassandra_cluster</span> <span class="o">=</span> <span class="p">[</span><span class="n">Cassandra</span><span class="p">(</span><span class="s2">&#34;c01&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                             <span class="n">Cassandra</span><span class="p">(</span><span class="s2">&#34;c02&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                             <span class="n">Cassandra</span><span class="p">(</span><span class="s2">&#34;c03&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">logstash</span> <span class="o">=</span> <span class="n">Logstash</span><span class="p">(</span><span class="s2">&#34;logstash&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">elasticsearch</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">(</span><span class="s2">&#34;elasticsearch&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">kibana</span> <span class="o">=</span> <span class="n">Kibana</span><span class="p">(</span><span class="s2">&#34;kibana&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cassandra_cluster</span> <span class="o">&gt;&gt;</span> <span class="n">logstash</span> <span class="o">&gt;&gt;</span> <span class="n">elasticsearch</span> <span class="o">&gt;&gt;</span> <span class="n">kibana</span>
</span></span></code></pre></div><h3 id="desenho-1">Desenho</h3>
<p><img src="/img/desenhando-infraestrutura-com-codigo/elk.png" alt="elk"></p>
<h1 id="conclusão">Conclusão</h1>
<p>Como vimos podemos organizar nossos diagramas no git e com isso manter um versionamento da nossa infraestrutura a medida que ela for evoluindo. Ainda estou explorando a ferramenta e estou gostando bastante da experiência. Uma dica é sempre que tiver os objetos já instânciados para serem conectados faça isso, meu primeiro diagrama fui fazer tudo no final e ficou um completo caos o desenho final. Agora, preciso ver se tem como escrever testes para o nosso desenho já que ele virou código.</p>
<p>O que você achou?</p>
</div>
  </article>
  <footer>
    <p>© 2026 João Maia</p>
  </footer>
</body>
</html>
